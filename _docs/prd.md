# Updated Product Requirements Document (PRD): The Testing Agent

## 1. Introduction & Purpose
Developers using AI coding assistants like Claude face a significant challenge in the feedback loop. The process of testing generated code and reporting back issues—which involves manually taking screenshots, copying console logs, describing user interactions, and inspecting DOM elements—is inefficient, tedious, and error-prone.

The **Testing Agent** is a new software tool designed to automate this entire feedback process. Built on the **Claude Code SDK**, this agent interprets test scripts generated by the primary AI assistant, executes them using a browser automation framework, meticulously documents every step, and provides intelligent, context-aware feedback upon request.

## 2. Goals & Objectives
*   **Primary Goal:** To create a seamless, automated testing and feedback loop between a developer and their AI coding assistant.
*   **Objectives:**
    *   Automate the execution of user-flow tests for web applications.
    *   Eliminate the developer's manual effort in capturing and reporting bugs or visual states.
    *   Provide the AI assistant with precise, rich data (visuals, logs, network activity) to diagnose issues effectively.
    *   Intelligently filter and deliver only relevant information to the AI, conserving its context window and token usage, by leveraging custom agent capabilities.

## 3. Features & Functionality
*   **Custom Agent Architecture:** The system will be implemented as a **Custom Agent** within the Claude Code SDK framework, allowing for specialized behavior, dedicated tools, and a managed context.
*   **Automated Test Execution:** The agent will use **Tool Calling** to execute Playwright test scripts generated by the primary AI assistant, defining the exact user flow to be tested.
*   **Transparent Test Execution:**
    *   The agent runs tests in a visible browser window (headed mode) by default, allowing developers to watch the automated flow in real-time. This provides instant visual feedback and builds confidence in the test's execution path.
*   **Comprehensive Data Capture:**
    *   **Interaction Logging:** The agent will log every interaction from the script (e.g., clicks, hovers, text input) with a precise timestamp.
    *   **Visual Documentation:** It will automatically take screenshots before and after every key interaction.
    *   **Console & Network Monitoring:** The agent will capture browser console logs and network tab activity.
    *   **DOM Inspection:** The agent can inspect DOM elements to verify CSS properties when requested.
*   **Intelligent, On-Demand Reporting:**
    *   **Natural Language Understanding:** The agent will leverage Claude's native ability to understand natural language requests from the primary AI session (e.g., "show me the console log").
    *   **Context-Aware Tool Calling:** The agent will translate these requests into specific tool calls to retrieve the correct piece of data from its recorded logs (e.g., `tool_get_console_logs({ filter: 'error' })`).
    *   **Selective Feedback:** By default, the agent will only provide data explicitly requested by the AI, but it will also proactively flag critical errors found in the console logs.

## 4. Technical Specification
*   **Core Framework:** The application will be built using the **Claude Code SDK (TypeScript)**, running as a Node.js process.
*   **Agent Definition:** A custom "Testing Agent" will be defined using YAML frontmatter, specifying its system prompt, capabilities, and a restricted set of tools.
*   **Browser Automation & Data Capture:**
    *   **Playwright & Playwright MCP:** The agent will interface with a browser via the **Playwright MCP (Model Context Protocol) server**. This provides the "hands and eyes" for the agent, enabling it to:
        *   Run automation scripts.
        *   Access the browser's Developer Tools API.
        *   Capture console events, network requests, and screenshots.
        *   Generate a comprehensive trace file for each test run.
*   **Agent Logic & Tooling:**
    *   **Test Executor Tool:** A primary tool function (`run_test(script_path)`) will manage the execution of a Playwright script and orchestrate the data capture.
    *   **Data Retrieval Tools:** A suite of tool functions (`get_screenshot`, `get_console_logs`, `get_network_activity`) will be defined in TypeScript. These functions will access the stored artifacts from a completed test run and return filtered, structured data to the agent.
    *   **Data Storage:** For each test run, the agent will create a time-stamped directory containing all artifacts: screenshots (named by action), a JSON log of all interactions, a console log file, a network log file, and the Playwright trace file.
